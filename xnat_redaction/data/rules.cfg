# inputs: user_id,affiliation_id,admin_id,subject_id,project_id,requested_phi

#
# CANCEL_ON_FAILURE
# PROMPT_ON_FAILURE
CONTINUE_ON_FAILURE

#example 1

query PHI_OUT SQL("SELECT COUNT(*) as `result` FROM (SELECT UNIQUE(`phi_field`) FROM `checkout_table` WHERE `affiliation_id` = ? AND `patient_id` = ?)")
rule DENY PHI_OUT.result > 3

#example 2

rule DENY checkout_phi_for_insitution >= 3


#other items:

redact DICOM_FIELD SOPInstanceUID
redact DICOM_FIELD StudyDate
redact DICOM_FIELD SeriesDate
redact DICOM_FIELD AcquisitionDate
redact DICOM_FIELD ContentDate
redact DICOM_FIELD AccessionNumber
redact DICOM_FIELD InstitutionName
redact DICOM_FIELD ReferringPhysicianName
redact DICOM_FIELD RefSOPInstanceUID
redact DICOM_FIELD PatientName
redact DICOM_FIELD PatientID
redact DICOM_FIELD PatientBirthDate
redact DICOM_FIELD StudyInstanceUID
redact DICOM_FIELD SeriesInstanceUID
redact DICOM_FIELD StudyID
redact DICOM_FIELD FrameOfReferenceUID
redact DICOM_FIELD BurnedInAnnotation
redact DICOM_FIELD UID
redact DICOM_FIELD StorageMediaFilesetUID
redact DICOM_FIELD ReferencedFrameOfReferenceUID
redact DICOM_FIELD RelatedFrameOfReferenceUID

redact REGEX "[0-9]{2}[-/][0-9]{2}[-/](([0-9]{2})|([0-9]{4}))" UnknownDateField
